(()=>{"use strict";function e(e,t="POST",n,s,a="json"){var o;const i=s||{};const r=Object.assign({cache:"no-cache",headers:{},redirect:"follow",mode:"cors"},{method:t}),c=Object.assign(r,i);if(c.method=null===(o=c.method)||void 0===o?void 0:o.toUpperCase(),"GET"===c.method){if(n){let t="";const s=/([?&])_=[^&]*/,a=/\?/;"object"==typeof n&&(t=function(e){let t="";for(const n in e)e.hasOwnProperty(n)&&(t+=n+"="+encodeURIComponent(e[n])+"&");return t.slice(0,-1)}(n)),e=s.test(e)?e.replace(s,"$1"+t):e+(a.test(e)?"&":"?")+t}}else[FormData,ArrayBuffer,Blob].filter((e=>n instanceof e)).length>0?c.body=n:(c.headers=Object.assign({"Content-Type":"application/json"},c.headers),n&&(c.body="string"==typeof n?n:JSON.stringify(n)));return fetch(e,c).then((e=>{const{status:t}=e;if(t>=200&&t<400){let t;switch(a){case"json":t=new Promise((t=>{e.text().then((e=>{try{t(JSON.parse(e))}catch(n){t(e)}}))}));break;case"text":t=e.text();break;case"blob":t=e.blob();break;case"arraybuffer":t=e.arrayBuffer();break;default:t=e.json()}return t}return Promise.reject(e)})).catch((e=>Promise.reject(e)))}const t=(t,n,s,a)=>e(t,"POST",n,s,a);const n="webpushinfoData",s="webPushTable";function a(e){const t=indexedDB.open(n);t.onupgradeneeded=function(e){var t;const n=null===(t=e.target)||void 0===t?void 0:t.result;if(!n.objectStoreNames.contains(s)){n.createObjectStore(s,{keyPath:"id"}).createIndex("name","name",{unique:!1})}},t.onerror=function(){},t.onsuccess=function(){e(t.result)}}function o(e,t="userInfoData"){a((a=>{try{const n=a.transaction([s],"readonly"),o=n.objectStore(s).index("name");o.get(t).onsuccess=function(t){t.target.result?e(t.target.result):e({})}}catch(t){!function(e=n){const t=indexedDB.deleteDatabase(e);t.onsuccess=function(){},t.onerror=function(){}}(),e({})}}))}let i={centerUrl:"https://global-websis.engagelab.com/v1/get-webaddr",prefix:".produce.min.3.0.0.js",version:"3.0.0",URL_POLLING:"",development:!1}.reportUrl,r=!1;function c(e){r?e(i):o((t=>{r=!0;const n=JSON.parse(t.data||"{}");n.reportUrl&&(i=n.reportUrl),e(i)}))}function l(e,n,s="W3Push"){n.mtpush_appkey&&(n.engagelab_appkey=n.mtpush_appkey),n.mtpush_passwd&&(n.engagelab_passwd=n.mtpush_passwd),n.mtpush_uid&&(n.engagelab_uid=n.mtpush_uid),e.forEach((e=>{const t=(new Date).getTime()/1e3|0;e.itime=t,e.msg_id&&(e.msg_id=e.msg_id.toString())}));const a={platform:"b",uid:n.engagelab_uid,app_key:n.engagelab_appkey,channel:s,content:e};c((e=>{t(e,a,{headers:{Authorization:"Basic "+btoa(a.uid+":"+n.engagelab_passwd)}})}))}self.addEventListener("install",(function(){self.skipWaiting()})),self.addEventListener("message",(function(e){const n=e.data||{code:0,msg:{}};var s;9965===n.code&&n.msg.reportUrl&&(i=n.msg.reportUrl),9999===n.code&&(s=n.msg,c((e=>{t(e,s.data,{headers:{Authorization:s.Authorization}})}))),6666===e.data.code&&l([{type:"msg_status",msg_id:n.msg.msg_id,result:3018}],n.msg)})),self.addEventListener("activate",(function(){return self.clients.claim()})),self.addEventListener("notificationclick",(function(e){const t=e.notification.data;if(t){const n="MTPush"===(t.engagelab_mesg_type||t.mtpush_mesg_type)?"MTPush":"W3Push";l([{type:"msg_status",msg_id:e.notification.tag,result:3002}],t,n);let s=(null==t?void 0:t.engagelab_url)||(null==t?void 0:t.mtpush_url);if(e.action&&t.engagelab_action_urls&&t.engagelab_action_urls[e.action]&&(s=t.engagelab_action_urls[e.action]),!s)return;if("Focus"===(null==t?void 0:t.engagelab_a_str)){const n=new URL(s).hostname;e.notification.close(),e.waitUntil(self.clients.matchAll({type:"window"}).then((e=>{let a;a="Exact"===(null==t?void 0:t.engagelab_m_str)?e.find((e=>new URL(e.url).href===s)):e.find((e=>new URL(e.url).hostname===n)),a?a.focus():self.clients.openWindow(s)})))}else e.notification.close(),e.waitUntil(self.clients.openWindow(s))}})),self.addEventListener("notificationclose",(function(e){})),self.addEventListener("push",(function(e){if(!e.data)return;const t=e.data.json();var n;if(t.locationTestDempWebPush52755665)self.registration.showNotification(t.title,t);else if(l([{type:"msg_status",msg_id:t.tag,result:3001}],t.data),self.clients.matchAll().then((e=>{e&&e.length&&e.forEach((e=>{e.postMessage(t)}))})),(n=t.data.ntf_or_msg)&&(1===n||3===n)){l([{type:"msg_status",msg_id:t.tag,result:3018}],t.data);const n=self.registration.showNotification(t.title,t);e.waitUntil(n)}}))})();